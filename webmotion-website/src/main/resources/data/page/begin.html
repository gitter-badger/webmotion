<!--
  #%L
  Webmotion website
  
  $Id$
  $HeadURL$
  %%
  Copyright (C) 2011 Debux
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as 
  published by the Free Software Foundation, either version 3 of the 
  License, or (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Lesser Public License for more details.
  
  You should have received a copy of the GNU General Lesser Public 
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/lgpl-3.0.html>.
  #L%
  -->
<div id="article">

<h1>Premiers pas avec WebMotion</h1>

<script type="text/javascript" src="js/generated_toc.js"></script>
<div id="generated-toc" class="generate_from_h2 generate_for_article"></div>

<h2 id="new_project" class="page-header">Création d'un nouveau projet</h2>

<h3 id="maven">Intégration dans un projet Maven</h3>
<p>Maven est un outil de gestion de construction de projets très connu dans le monde Java. Si vous ne connaissez pas Maven, nous vous invitons à consulter <a href="http://maven.apache.org">le site officiel</a>.</p>

<p>
    <span class="label label-info">Note</span>
    Vous ne souhaitez pas utiliser Maven pour votre projet, vous pouvez lire la rubrique liée à <a href="#eclipse">l'intégration de WebMotion dans un projet Java dans l'éditeur Eclipse</a>.
</p>

<p>WebMotion s'intègre parfaitement dans un projet Maven. Il existe d'ailleurs un archetype pour vous aider à créer un nouveau projet. Commençons par créer un projet (en ligne de commande) :</p>

<pre>
$ mvn archetype:generate \
    -DarchetypeGroupId=org.debux.webmotion \
    -DarchetypeArtifactId=webmotion-archetype \
    -DarchetypeVersion=2.4 \
    -DgroupId=org.example \
    -DartifactId=myapp \
    -Dpackage=org.example.myapp \
    -Dversion=1.0-SNAPSHOT \
    -DusesExtras=N
</pre>
<p>
    <span class="label label-warning">Note</span>
    Penser à vérifier la dernière version de l'archetype.
</p>

<p>À présent, le projet est créé. Il suffit de packager le projet pour vérifier que tout est correcte :</p>
<pre>$ mvn package
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 8.181s
[INFO] Finished at: Sat Feb 11 20:49:59 CET 2012
[INFO] Final Memory: 10M/122M
[INFO] ------------------------------------------------------------------------
</pre>

<p>Le projet est créé, la prochaine étape est <a href="#first_page">la création notre première page</a>.</p>

<h3 id="netbeans">Intégration dans un projet créé avec l'éditeur Netbeans</h3>

<p>Si vous souhaitez utiliser l'éditeur Netbeans mais que vous ne le possédez pas encore, il est possible de le télécharger depuis le <a href="http://netbeans.org/downloads/index.html">le site officiel</a>, en choisisant la version Java EE.</p>
<p>Une fois votre éditeur lancé, il vous suffit de créer un nouveau projet Maven depuis un archetype.</p>

<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width: 500px; display:inline-block; margin-right: 10px;">
        <img src="media?name=netbeans_new_project.png" alt="New project in Netbeans" title="New project in Netbeans" />
    </a>
    <a class="thumbnail" style="width: 500px; display:inline-block;">
        <img src="media?name=netbeans_add_archetype.png" alt="Add archetype in Netbeans" title="Add archetype in Netbeans" />
    </a>
</div>

<p>Enfin remplir les informations sur votre projet :</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width: 500px; display:inline-block;">
        <img src="media?name=netbeans_complete_project.png" alt="Complete project in Netbeans" title="Complete project in Netbeans" />
    </a>
</div>

<p><span class="label label-info">Note</span> Vous pouvez lancer dans Netbeans le serveur d'applications ainsi <code>Clic droit sur le projet → Run</code> puis choisir le serveur.</p>

<div class="alert alert-info">
    <p>
        <span class="label label-info">Astuce</span>&nbsp;Le rechargement à chaud (modification de contrôleurs, par exemple) de votre application dans Netbeans est désactivé par défaut. Pour en bénéficier, il faut modifier les propriétés 
        du projet :<br /><code>clic droit sur le projet &rarr; properties &rarr; section "Build" &rarr; sous-section "Compile" &rarr; sélectionner "For both application and test execution" pour l'option "Compile on save"</code>.
    </p>
    <div style="text-align: center; margin: 0px 0px 20px 20px;">
        <a class="thumbnail" style="width: 500px; display:inline-block;">
            <img src="media?name=netbeans_compile.png" alt="Properties compile" title="Properties compile" />
        </a>
    </div>
</div>

<p>Le projet est créé, la prochaine étape est <a href="#first_page">la création notre première page</a>.</p>

<h3 id="eclipse">Intégrer WebMotion dans un projet Java dans l'éditeur Eclipse</h3>
<p>Pour utiliser WebMotion avec Eclipse, il vous faut télécharger et installer Eclipse en version Java EE Developers,
    disponible à l'adresse suivante <a href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/</a>.
</p>

<p>
    Créer un projet Web : <code>Menu "File" → Sous-menu "New" → Dynamic Web Project</code>
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width: 500px; display:inline-block;">
        <img src="media?name=eclipse_new_project.png" alt="New project in eclipse" title="New project in eclipse" />
    </a>
</div>

<p>
    Commencer par copier le jar de WebMotion et les dépendances de la version full 
    dans le répertoire <code>/WebContent/WEB-INF/lib</code>. 
    Puis rajouter les dépendances dans le classpath au niveau des propriétées du 
    projet : <code>Clic droit sur le projet 
    → menu "Properties" → section "Java Build Path" 
    → sous-section "Librairies" → appuyer sur "Add JARs..." 
    → sélectionner les jars de WebMotion du répertoire "/WebContent/WEB-INF/lib".</code>
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width:500px; display:inline-block;">
        <img src="media?name=eclipse_import_jar.png" alt="Import jar" title="Import jar" />
    </a>
</div>

<p>
    Déployer votre application sur un serveur : <code>Clic droit sur le projet → Run as  → Run on server</code>
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width:500px; display:inline-block;">
        <img src="media?name=eclipse_run.png" alt="Run on server" title="Run on server" />
    </a>
</div>

<p>Le projet est créé, la prochaine étape est <a href="#first_page">la création notre première page</a>.</p>

<h2 id="first_page" class="page-header">Créer ma première page web avec WebMotion</h2>
<p>
    Pour créer la première page de notre projet. Il est important de savoir que sauf cas particuliers, 
    il n'est pas nécessaire de modifier le fichier <code>web.xml</code>.
    En effet, la servlet utilisée par WebMotion est déclarée et définie dans le <code>web-fragment</code> embarqué avec le framework. 
    Ce fragment est chargé de manière automatique, il est donc possible (et courant) d'avoir un fichier <code>web.xml</code> vide.
</p>
<p>
    <span class="label label-info">Note</span>&nbsp;
    Il est possible de retrouver ce cas d'utilisation dans la section <a href="showcase/hello">démonstration</a>.
</p>

<h3>Le fichier web.xml</h3>
<p>
    Bien qu'un fichier web.xml vide suffise, ce fichier doit tout de même définir la version de l'application web. 
    En effet, WebMotion dépend de la plate-forme Java EE 6, qui contient l'API Servlet en version 3, supportant notamment les <code>web-fragment</code>. 
    Le fichier <code>web.xml</code> devrait donc ressembler à ceci :
</p>
<pre class="prettyprint">
&lt;web-app version="3.0"
  xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
  http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" /&gt;
</pre>

<h3 id="mapping">Le fichier de mapping</h3>
<p>
    WebMotion repose sur un fichier de mapping pour déclarer les ressources accessibles dans notre applications web. 
    Ce fichier doit être nommé <code>mapping</code> et doit se situer dans le classpath du projet.  
</p>
<p>
    Le fichier de mapping se compose de 5 rubriques principales :
</p>
<ul>
    <li><code>[config]</code>&nbsp;La configuration de l'application web</li>
    <li><code>[errors]</code>&nbsp;Les actions liées aux erreurs (techniques et / ou applicatives)</li>
    <li><code>[filters]</code>&nbsp;Les filtres de l'applications</li>
    <li><code>[actions]</code>&nbsp;Les actions liées aux URL de l'application</li>
    <li><code>[extensions]</code>&nbsp;Les extensions utilisées par l'application</li>
</ul>
<p>
    Cependant, pour la réalisation de la première page de notre application, 
    nous allons commencer avec un fichier de mapping le plus minimaliste possible.
</p>
<pre>
[actions]
GET     /                            view:index.jsp
</pre>
<p>
    Dans ce fichier de mapping, nous venons de définir l'action à réaliser sur le path racine <code>/</code> de notre application.
    L'action qui sera exécutée est le rendu d'une page nommée index.jsp, qui est située à la racine du répertoire <code>webapp</code> 
    de votre projet, qui est le répertoire par défaut contenant les pages web de votre application.
</p>
<p>
    Chaque ligne de mapping contient au minimum 3 informations (séparées par des espaces) :
</p>
<ul>
    <li>
        <strong>La ou les méthodes HTTP autorisées pour le path défini : </strong> les méthodes les plus communément utilisées sont 
        <code>GET</code>, <code>POST</code>, <code>HEAD</code>, <code>PUT</code> et <code>DELETE</code>.
        Toutes les méthodes HTTP sont décrites dans la <a href="http://tools.ietf.org/html/rfc2616#page-51">spécification</a>.
        Trois syntaxe sont possibles :
        <ul>
            <li>Le nom d'une méthode HTTP en majuscules (exemple : <code>POST</code>)</li>
            <li>Les noms de plusieurs méthode HTTP, séparées par des virgules (exemple : <code>GET,POST</code>)</li>
            <li>Un astérisque pour préciser que toutes les méthodes HTTP sont autorisées</li>
        </ul>
    </li>
    <li>
        <strong>Le path</strong> que l'on souhaite configuré sur notre application web. Le path est relatif par rapport au contexte de l'application. 
        Exemple : si le contexte de l'application est <code>webmotion-sample</code>, alors le path <code>/index</code> correspondra à l'URI suivante : 
        <pre>http://&lt;host&gt;/webmotion-sample<code>/index</code></pre>
    </li>
    <li>
        <strong>L'action à réaliser</strong> sur le path et la méthode HTTP configurés. Il peut s'agir d'une action, exécutée par le biais d'un contrôleur, 
        d'une redirection ou encore de l'affichage d'une page sans traitement préalable.
        Ici, le préfixe <code>view:</code> indique qu'il s'agit d'un traitement d'affichage simple d'une page.
    </li>
</ul>

<h3>La vue</h3>
<p>
    Ainsi, notre page <code>index.jsp</code> défini par le fichier de mapping précédemment écrit :
</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;It's easy to build a web application with WebMotion&lt;/title&gt;
        &lt;meta charset="utf-8" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello World!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<h3>Testons notre première page</h3>
<p>
    A présent, c'est l'heure de vérifier que notre page est accessible. Pour cela, il suffit de déployer l'application sur un serveur sachant interpréter l'API Servlet 3, 
    comme par exemple le conteneur de servlet <a href="http://tomcat.apache.org/download-70.cgi">Apache Tomcat 7</a>.
</p>
<div class="alert alert-info">
    <p>
        <span class="label label-info">Note</span>&nbsp;Si vous utilisez Maven pour contruire votre projet. Vous pouvez tester plus simplement encore votre application,
        grâce au conteneur de servlet <a href="http://jetty.codehaus.org/jetty/">Jetty</a>. Pour utiliser ce serveur, 
        il faut ajouter dans votre fichier <code>pom.xml</code> le plugin <code>jetty-maven-plugin</code>, comme suit :
    </p>
    <pre class="prettyprint">
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
      &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;8.0.4.v20111024&lt;/version&gt;&lt;!-- Pensez à vérifier le dernier numéro de version disponible --&gt;
      &lt;configuration&gt;
        &lt;webApp&gt;
          &lt;contextPath&gt;/webmotion-sample&lt;/contextPath&gt;
        &lt;/webApp&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</pre>
    <p>Puis, lancer la commande suivante pour lancer le serveur :</p>
    <pre>mvn jetty:run</pre>
</div>
<p>
    Une fois l'application déployée, ouvrez votre navigateur favori et rendez-vous à l'adresse suivante : <code>http://localhost:8080/webmotion-sample/</code>.
    Si tout se passe bien, vous devriez voir la page affichée ci-dessous :
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width:500px; display: inline-block;">
        <img src="media?name=hello_world.png" alt="Affichage de la page Hello World" title="Rendu de la page Hello World" />
    </a>
</div>
<div class="alert alert-warning">
    <p>
        <span class="label label-warning">Attention</span>&nbsp;Si vous obtenez l'erreur : <code>org.debux.webmotion.server.WebMotionException: Not mapping found for url /webmotion-sample/</code>,
        vérifiez que le contexte de votre application est bien défini comme suit dans le fichier <code>META-INF/context.xml</code> :<br /><br />
    </p>
    <pre class="prettyprint">&lt;Context antiJARLocking="true" path="/webmotion-sample"/&gt;</pre>
</div>

<h2 id="work_with_parameters" class="page-header">Utilisation des paramètres de la requête HTTP dans un contrôleur</h2>
<p>
    <span class="label label-info">Note</span>&nbsp;
    Il est possible de retrouver ce cas d'utilisation dans la section <a href="showcase/helloParameters">démonstration</a>.
</p>
<p>
    À présent, nous savons comment réaliser un &laquo;&nbsp;Hello world!&nbsp;&raquo; avec WebMotion. 
    L'étape suivante consiste en la réalisation d'un message de bienvenue personnalisé à un visiteur. 
    Il s'agira pour ce cas simple de passer le nom de l'utilisateur en paramètre de la requête.
</p>
<p>
    Pour ce faire, nous allons procéder en plusieurs étapes :
</p>
<ul>
    <li><a href="#modification-mapping">Modification du fichier de mapping</a></li>
    <li><a href="#creation-controleur">Création d'un contrôleur</a></li>
    <li><a href="#creation-vue">Création d'une nouvelle vue</a></li>
    <li><a href="#tester-resultat">Tester le résultat</a></li>
</ul>

<h3 id="modification-mapping">Modification du fichier de mapping</h3>
<p>
    Le fichier de mapping précédemment utilisé pour le &laquo;&nbsp;Hello world!&nbsp;&raquo; était minimaliste. 
    Nous allons l'aggrémenter afin de rendre possible l'ajout simple d'autres path qui bénéficieront d'un traitement plus avancé.
</p>
<pre>
[config]
package.actions=org.debux.sample.actions

[actions]
GET     /                           view:index.jsp
GET     /hello?user={user}          Hello:sayHello
</pre>
<p>
    Une section <code>[config]</code> a été ajoutée dans ce fichier de mapping. Cette section, si elle est définie, doit-être la première présente dans le fichier de mapping.
    Cette section contient ici la définition du package Java qui va contenir l'ensemble des contrôleurs de l'application.
    Dans ce cas présent, il s'agira du package <code>org.debux.sample.actions</code>.
</p>
<p>
    Dans la section <code>[actions]</code>, un chemin de l'application a été ajouté. 
    Ainsi, en accédant au chemin <code>/hello?user={user}</code> par le biais d'une requête <code>GET</code>,
    Le traitement de la requête sera effectué par la classe <code>Hello</code> du package <code>org.debux.sample.actions</code>, 
    par l'exécution de la méthode <code>sayHello</code>.
</p>

<h3 id="creation-controleur">Création d'un contrôleur</h3>
<p>
    Tout contrôleur d'une application web utilisant WebMotion doit êtendre la classe <code>org.debux.webmotion.server.WebMotionController</code>.
    Ainsi, créons notre classe <code>org.debux.sample.actions.Hello</code> :
</p>
<pre class="prettyprint">
package org.debux.sample.action;

import org.debux.webmotion.server.WebMotionController;
import org.debux.webmotion.server.call.Render;

public class Hello extends WebMotionController {
    
    public Render sayHello(String user) {
        return renderView("hello.jsp", 
            "name", user); // couple clé = valeur
    }
    
}
</pre>
<p>
    Dans notre contrôleur, il faut remarquer la présence du paramètre <code>user</code>.
    Il s'agit du même paramètre défini dans le fichier de mapping, à savoir :<br />
    <code>/hello?user=<b>{user}</b></code>.
    Le contrôleur ici effectue l'action de rendre à vue à l'utilisateur, en lui précisant un modèle, 
    qui est une liste de paramètres constituant un ensemble de couples clé / valeur.
</p>

<h3 id="creation-vue">Création d'une nouvelle vue</h3>
<p>
    À présent, créons notre page <code>hello.jsp</code>.
</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;It's easy to build a web application with WebMotion&lt;/title&gt;
        &lt;meta charset="utf-8" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello ${name}!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>Il est à noter la présence du paramètre <code>name</code>, que l'on a défini comme clé du modèle transmis depuis le contrôleur.</p>

<h3 id="tester-resultat">Tester le résultat</h3>
<p>
    Nous allons tester le résultat en passant différentes valeurs pour le paramètre <code>user</code> de la requête.
    Commençons avec l'URL suivante : <code>http://localhost:8080/webmotion-sample/hello?user=<b>World</b></code>.
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="display:inline-block; width:500px;">
        <img src="media?name=hello_parameters_1.png" alt="Affichage de la page Hello World" title="Rendu de la page Hello World" />
    </a>
</div>
<p>
    Nous avons ici visiblement la même page que lorsque nous avons créé la page &laquo;&nbsp;Hello World!&nbsp;&raquo;.
    Essayons maintenant de changer la valeur du paramètre <code>user</code>, comme suit :
    <code>http://localhost:8080/webmotion-sample/hello?user=<b>you</b></code>.
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="display:inline-block; width:500px;">
        <img src="media?name=hello_parameters_2.png" alt="Affichage de la page Hello you" title="Rendu de la page Hello you" />
    </a>
</div>

<div class="well" style="text-align: center;">
    <a class="btn large" style="float:left;" href="documentation">« Documentation</a>
    <a class="btn large" style="margin: 0 auto;" href="#">Haut de page</a>
    <a class="btn primary large" style="float:right;" href="mapping">Mapping »</a>
</div>

</div>
