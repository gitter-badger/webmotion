<!--
  #%L
  Webmotion website

  $Id$
  $HeadURL$
  %%
  Copyright (C) 2011 Debux
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Lesser Public License for more details.

  You should have received a copy of the GNU General Lesser Public
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/lgpl-3.0.html>.
  #L%
  -->
<div id="article">

<h1>First steps with WebMotion</h1>

<script type="text/javascript" src="js/generated_toc.js"></script>
<div id="generated-toc" class="generate_from_h2 generate_for_article"></div>

<h2 id="new_project" class="page-header">New project creation</h2>

<h3 id="maven">Integration in a Maven project</h3>
<p>
    Maven is a tool to manage the project builds, well-known in the Java world.
    If you do not know Maven, we invite you to consult <a href="http://maven.apache.org">the official site</a>.
</p>

<p>
    <span class="label label-info">Note</span>
    If you do not want to use Maven to manage your project, you can read the rubric about <a href="#eclipse">the integration of WebMotion in a Java project with the Eclipse IDE</a>.
</p>

<p>
    Webmotion fits perfectly in a Maven project.
    There is also an archetype to help you create a new project.
    Let's start by creating a project (command line):
</p>

<pre>
$ mvn archetype:generate \
    -DarchetypeRepository=http://debux.org/maven/repo \
    -DarchetypeGroupId=org.debux.webmotion \
    -DarchetypeArtifactId=webmotion-archetype \
    -DarchetypeVersion=2.1 \
    -DgroupId=org.example \
    -DartifactId=myapp \
    -Dpackage=org.example.myapp \
    -Dversion=1.0-SNAPSHOT
</pre>
<p>
    <span class="label label-warning">Note</span>
    Check the last version of the archetype.
</p>

<p>
    Now the project has been created. You just need to package the project to check that everything is correct:
</p>
<pre>$ mvn package
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 8.181s
[INFO] Finished at: Sat Feb 11 20:49:59 CET 2012
[INFO] Final Memory: 10M/122M
[INFO] ------------------------------------------------------------------------
</pre>

<p>
    The project is created, the next step is <a href="#first_page">the creation of our first page</a>.
</p>

<h3 id="netbeans">
    Integration in a project created with the Netbeans IDE
</h3>

<p>
    You wish to use the Netbeans IDE but you have not got it yet,
    you can download it on <a href="http://netbeans.org/downloads/index.html">the official website</a> by choosing the Java EE version.
</p>
<p>
    Once you have launched the IDE, you just need to create a new Maven project from an archetype.
</p>

<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width: 500px; display:inline-block; margin-right: 10px;">
        <img src="media?name=netbeans_new_project.png" alt="New project in Netbeans" title="New project in Netbeans" />
    </a>
    <a class="thumbnail" style="width: 500px; display:inline-block;">
        <img src="media?name=netbeans_add_archetype.png" alt="Add archetype in Netbeans" title="Add archetype in Netbeans" />
    </a>
</div>

<p>
    Finally fill the information about your project:
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width: 500px; display:inline-block;">
        <img src="media?name=netbeans_complete_project.png" alt="Complete project in Netbeans" title="Complete project in Netbeans" />
    </a>
</div>

<p>
    <span class="label label-info">Note</span>
    You can launch the application server in Netbeans by doing:
    <code>Right click on the project → Run</code> then choose the server.
</p>

<div class="alert alert-info">
    <p>
        <span class="label label-info">Tip</span>
        &nbsp;The warm reboot (modification of the controllers for instance) of your application in Netbeans is disabled by default.
        To enable it, you need to modify the project properties:<br />
        <code>
            Right click on the project &rarr; properties &rarr; "Build" section &rarr;
            "Compile" subsection &rarr; select "For both application and test execution" for the "Compile on save" option
        </code>.
    </p>
    <div style="text-align: center; margin: 0px 0px 20px 20px;">
        <a class="thumbnail" style="width: 500px; display:inline-block;">
            <img src="media?name=netbeans_compile.png" alt="Properties compile" title="Properties compile" />
        </a>
    </div>
</div>

<p>
    The project is created, the next step is <a href="#first_page">the creation of our first page</a>.
</p>

<h3 id="eclipse">
    Integration in a Java project in the Eclipse IDE
</h3>

<p>
    To use WebMotion with Eclipse, you need to download and install Java EE Developers version of Eclipse,
    available at the following URL: <a href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/</a>.
</p>

<p>
    Create a web project: <code>"File" menu → "New" submenu → Dynamic Web Project</code>
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width: 500px; display:inline-block;">
        <img src="media?name=eclipse_new_project.png" alt="New project in eclipse" title="New project in eclipse" />
    </a>
</div>

<p>
    Add the dependencies in the classpath in the project properties by using "Add external jar":
    <br />
    <code>Right click on the project → properties → "Java Build Path" section → "Libraries" subsection → click on "Add external jar" → select the WebMotion jar plus the full version dependencies</code>
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width:500px; display:inline-block;">
        <img src="media?name=eclipse_import_jar.png" alt="Import jar" title="Import jar" />
    </a>
</div>

<p>
    Deploy your application on a server: <code>Right click on the project → Run as  → Run on server</code>
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width:500px; display:inline-block;">
        <img src="media?name=eclipse_run.png" alt="Run on server" title="Run on server" />
    </a>
</div>

<p>The project is created, the next step is <a href="#first_page">the creation of our first page</a>.</p>

<h2 id="first_page" class="page-header">Créer ma première page web avec WebMotion</h2>
<p>
    To create the first page of our project, it is important to know that except in special cases, it is not necessary to change the <code>web.xml</code> file.
    Indeed, the servlet used by WebMotion is declared and defined in the <code>web-fragment</code> embedded by the framework.
    This fragment is automatically loaded, so it is possible (and usual) to have an empty <code>web.xml</code> file.
</p>
<p>
    <span class="label label-info">Note</span>&nbsp;
    There is an example of this use case in the <a href="showcase/hello">demo</a> section.
</p>

<h3>The web.xml file</h3>
<p>
    Although an empty web.xml file is enough, this file must however define the webapp version.
    Indeed, WebMotion depends on the Java EE 6 platform which contains the Servlet API in version 3, supporting the <code>web-fragment</code>.
    The <code>web.xml</code> file should be like this:
</p>
<pre class="prettyprint">
&lt;web-app version="3.0"
  xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
  http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" /&gt;
</pre>

<h3 id="mapping">The mapping file</h3>
<p>
    WebMotion is based on a mapping file to declare the available resources of our web application.
    This file must be named <code>mapping</code> and must be in the project classpath.
</p>
<p>
    The mapping file consists of five main sections:
</p>
<ul>
    <li><code>[config]</code>&nbsp;The web application configuration</li>
    <li><code>[errors]</code>&nbsp;The actions linked to the errors (technical and/or applicative)</li>
    <li><code>[filters]</code>&nbsp;The application filters</li>
    <li><code>[actions]</code>&nbsp;The actions linked to the application URLs</li>
    <li><code>[extensions]</code>&nbsp;The extensions used by the application</li>
</ul>
<p>
    However, to realize the first page of our application, we will start with a mapping file as minimalist as possible.
</p>
<pre>
[actions]
GET     /                            view:index.jsp
</pre>
<p>
    In this mapping file, we have just defined the action to execute on the root path <code>/</code> of our application.
    The action which will be executed is the rendering of a page named index.jsp, which is at the root of the <code>webapp</code> directory of your project, which is the default directory containing the web pages of your application.
</p>
<p>
    Each mapping line contains at least 3 pieces of information (seperated by spaces):
</p>
<ul>
    <li>
        <strong>The HTTP method(s) authorized for the defined path:</strong> the most commonly used methods are <code>GET</code>, <code>POST</code>, <code>HEAD</code>, <code>PUT</code> and <code>DELETE</code>.
        All the HTTP methods are described in the <a href="http://tools.ietf.org/html/rfc2616#page-51">spécification</a>.
        Three syntaxes are possible:
        <ul>
            <li>The uppercase name of an HTTP method (example: <code>POST</code>)</li>
            <li>The nmes of several HTTP methods, separated by commas (example: <code>GET,POST</code>)</li>
            <li>An asterisk to precise that all the HTTP methods are authorized</li>
        </ul>
    </li>
    <li>
        <strong>The path</strong> that we want to configure on our web application. The path is relative to the application context.
        Example: if the application context is <code>webmotion-sample</code>, then the path <code>/index</code> will mtch the following URI:
        <pre>http://&lt;host&gt;/webmotion-sample<code>/index</code></pre>
    </li>
    <li>
        <strong>The action to execute</strong> on the path and the configuredHTTP method. It can be an action executed via a controller, a redirection or the display of a page without any prior treatment.
        Here, the <code>view:</code> prefix indicates that it is a simple display treatment.
    </li>
</ul>

<h3>The view</h3>
<p>
    Thus, our <code>index.jsp</code> page defined by the previsouly written mapping file:
</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;It's easy to build a web application with WebMotion&lt;/title&gt;
        &lt;meta charset="utf-8" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello World!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<h3>Let's test our first page</h3>
<p>
    Now, it is time to check that our first page is available.
    To do it, you just need to deploy the application in a server which can interpret the Servlet 3 API,
    like for instance the <a href="http://tomcat.apache.org/download-70.cgi">Apache Tomcat 7</a> servlet container.
</p>
<div class="alert alert-info">
    <p>
        <span class="label label-info">Note</span>&nbsp;
        If you are using Maven to build your project, you can test even more easily your application 
        thanks to the <a href="http://jetty.codehaus.org/jetty/">Jetty</a> servlet container.
        To use this server, you need to add the <code>jetty-maven-plugin</code> plugin in your <code>pom.xml</code> file as follows:
    </p>
    <pre class="prettyprint">
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
      &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;8.0.4.v20111024&lt;/version&gt;&lt;!-- Check the last available version number --&gt;
      &lt;configuration&gt;
        &lt;webApp&gt;
          &lt;contextPath&gt;/webmotion-sample&lt;/contextPath&gt;
        &lt;/webApp&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</pre>
    <p>Then launch the following command to start the server:</p>
    <pre>mvn jetty:run</pre>
</div>
<p>
    Once the application is deployed, open your favorite web browser and go to the following address: <code>http://localhost:8080/webmotion-sample/</code>.
    If everything is OK, you should see the following page:
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="width:500px; display: inline-block;">
        <img src="media?name=hello_world.png" alt="Hello World page display" title="Hello World page rendering" />
    </a>
</div>
<div class="alert alert-warning">
    <p>
        <span class="label label-warning">Warning</span>&nbsp;
        If you have got the error: <code>org.debux.webmotion.server.WebMotionException: Not mapping found for url /webmotion-sample/</code>,
        check that your application context is well defined in the <code>META-INF/context.xml</code> file as follows:<br /><br />
    </p>
    <pre class="prettyprint">&lt;Context antiJARLocking="true" path="/webmotion-sample"/&gt;</pre>
</div>

<h2 id="work_with_parameters" class="page-header">Use of the HTTP request parameters in a controller</h2>
<p>
    <span class="label label-info">Note</span>&nbsp;
    There is an example of this use case in the <a href="showcase/helloParameters">demo</a> section.
</p>
<p>
    Now, we know how to realize a &laquo;&nbsp;Hello world!&nbsp;&raquo; with WebMotion.
    The following step consists in realizing a welcome message personalized for each visitor.
    This will be for this simple case of passing the user name as a request parameter.
</p>
<p>
    To do so, we will proceed in several steps:
</p>
<ul>
    <li><a href="#modification-mapping">Modification of the mapping file</a></li>
    <li><a href="#creation-controleur">Creation of a controller</a></li>
    <li><a href="#creation-vue">Creation of a new view</a></li>
    <li><a href="#tester-resultat">Test the result</a></li>
</ul>

<h3 id="modification-mapping">Modification of the mapping file</h3>
<p>
    The mapping file previously used for &laquo;&nbsp;Hello world!&nbsp;&raquo; was minimalist.
    We are going to add a few lines to enable the simple adding of other paths which will have a more advanced treatment.
</p>
<pre>
[config]
package.actions=org.debux.sample.actions

[actions]
GET     /                           view:index.jsp
GET     /hello?user={user}          Hello:sayHello
</pre>
<p>
    A <code>[config]</code> section was added in this mapping file.
    This section, if it is defined, must be the first of the mapping file.
    This section contains here the definition of the Java package which will contain all the application controllers.
    In the present case, it is the <code>org.debux.sample.actions</code> package.
</p>
<p>
    In the <code>[actions]</code> section, a path of the application was added.
    Thereby, by accessing the path <code>/hello?user={user}</code> through a <code>GET</code> request,
    the request treatment will be performed by the <code>Hello</code> class of the <code>org.debux.sample.actions</code> package
    by calling the <code>sayHello</code> method.
</p>

<h3 id="creation-controleur">Creation of a controller</h3>
<p>
    Every controller of a web application using WebMotion must extend the class <code>org.debux.webmotion.server.WebMotionController</code>.
    Thus, let's create our class <code>org.debux.sample.actions.Hello</code>:
</p>
<pre class="prettyprint">
package org.debux.sample.action;

import org.debux.webmotion.server.WebMotionController;
import org.debux.webmotion.server.call.Render;

public class Hello extends WebMotionController {

    public Render sayHello(String user) {
        return renderView("hello.jsp",
            "name", user); // key = value pair
    }

}
</pre>
<p>
    In our controller, you can notice the presence of the <code>user</code> parameter.
    It is the same parameter as the one defined in the mapping file, which is:<br />
    <code>/hello?user=<b>{user}</b></code>.
    Here, the controller performs the action of rendering the view to the user, by specifying a model,
    which is a list of parameters in the form of a set of key/value.
</p>

<h3 id="creation-vue">Creation of a new view</h3>
<p>
    Now, let's create our page <code>hello.jsp</code>.
</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;It's easy to build a web application with WebMotion&lt;/title&gt;
        &lt;meta charset="utf-8" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello ${name}!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>
    You can notice the presence of the parameter <code>name</code>,
    that we defined as the key of the model transmitted from the controller.
</p>

<h3 id="tester-resultat">Test the result</h3>
<p>
    We are going to test the result by passing different values for the request parameter <code>user</code>.
    Let's start with the following URL: <code>http://localhost:8080/webmotion-sample/hello?user=<b>World</b></code>.
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="display:inline-block; width:500px;">
        <img src="media?name=hello_parameters_1.png" alt="Display of the Hello World page" title="Hello World page rendering" />
    </a>
</div>
<p>
    Here we have obviously the same page as when we created the page &laquo;&nbsp;Hello World!&nbsp;&raquo;.
    Now let's test to change the value of the <code>user</code> parameter as follows:
    <code>http://localhost:8080/webmotion-sample/hello?user=<b>you</b></code>.
</p>
<div style="text-align: center; margin: 0px 0px 20px 20px;">
    <a class="thumbnail" style="display:inline-block; width:500px;">
        <img src="media?name=hello_parameters_2.png" alt="Display of the Hello you page" title="Hello you page rendering" />
    </a>
</div>

<div class="well" style="text-align: center;">
    <a class="btn large" style="float:left;" href="documentation">« Documentation</a>
    <a class="btn large" style="margin: 0 auto;" href="#">Top</a>
    <a class="btn primary large" style="float:right;" href="mapping">Mapping »</a>
</div>

</div>